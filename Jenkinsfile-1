pipeline { 
    agent { 
        label 'local'
    }
    stages {
        stage('Build') {
            steps {
                script {
                    def commit = checkout scm
                    // we set BRANCH_NAME to make when { branch } syntax work without multibranch job
                    env.BRANCH_NAME = commit.GIT_BRANCH.replace('origin/', '')

                    //actually build ...
                }
            }
        }
        stage("Deploy to main") {
            when { 
                // branch 'main' 
                changeset "main/**"    
            }
            steps {
                echo "Deploy to main production."
            }
        }
        stage("Deploy to dev") {
            when { 
               // branch 'dev' 
               changeset "dev/**"     
            }
            steps {
                echo "Deploy to dev production."
            }
        }       
    }
}
